<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Namensliste mit Anwesenheitszählung (8 Freitage)</title>
  <style>
    :root{--bg:#f7f9fc;--card:#ffffff;--accent:#2563eb;--muted:#6b7280}
    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--bg); margin:0; padding:24px; color:#0f172a}
    .container{max-width:720px; margin:0 auto}
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px;flex-wrap:wrap;justify-content:space-between}
    h1{margin:0;font-size:20px}
    .card{background:var(--card);border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(2,6,23,0.06)}
    form{display:flex;gap:8px;flex-wrap:wrap}
    input[type=text]{flex:1;padding:10px;border-radius:8px;border:1px solid #e6edf3}
    button{border:0;padding:10px 16px;border-radius:10px;cursor:pointer;min-width:44px;min-height:44px;font-size:18px}
    button.primary{background:var(--accent);color:#fff;padding:10px 14px;min-height:auto;font-size:16px}
    .stats{display:flex;gap:12px;align-items:center;margin-top:12px;color:var(--muted)}
    ul{list-style:none;padding:0;margin:12px 0 0}
    li{display:flex;flex-direction:column;gap:6px;padding:10px;border-radius:8px}
    li:nth-child(odd){background:linear-gradient(0deg, rgba(2,6,23,0.03), rgba(2,6,23,0.03))}
    .row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
    .name{flex:1;cursor:pointer;font-weight:500}
    .count{font-weight:500;min-width:60px;text-align:center}
    .checkboxes{display:flex;gap:6px;align-items:center;justify-content:center}
    .icon-btn{background:transparent;border:1px solid #d1d5db;cursor:pointer;padding:10px 14px;border-radius:10px;font-size:20px;min-width:44px;min-height:44px}
    .details{font-size:13px;color:var(--muted);margin-left:28px}
    .hidden{display:none}
    .tabs{display:flex;gap:8px;margin-bottom:12px}
    .tab-btn{background:#e5e7eb;padding:8px 12px;border-radius:8px;cursor:pointer;border:0}
    .tab-btn.active{background:var(--accent);color:#fff}
    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
    input[type=checkbox]{transform:scale(1.2);cursor:pointer}
    .check-title{text-align:right;font-size:13px;color:var(--muted);margin-bottom:4px}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Anwesenheitsliste</h1>
      <div class="tabs">
        <button id="activeTab" class="tab-btn active">Aktive Kinder</button>
        <button id="doneTab" class="tab-btn">Fertige Kinder</button>
      </div>
    </header>

    <section class="card" id="activeSection">
      <form id="addForm">
        <input id="nameInput" type="text" placeholder="Name hinzufügen (z. B. Maria)" autocomplete="off" />
        <button id="addBtn" class="primary" type="submit">Hinzufügen</button>
      </form>
      <div class="stats">
        <div id="totalStat">Gesamt: 0</div>
      </div>
      <div class="check-title">Abgabe / Anmeldung</div>
      <ul id="list"></ul>
    </section>

    <section class="card hidden" id="doneSection">
      <button id="backBtn">← Zurück</button>
      <h2>Fertige Kinder</h2>
      <ul id="doneList"></ul>
    </section>

    <footer>Die Anwesenheiten werden lokal im Browser gespeichert.</footer>
  </div>

  <script>
    const STORAGE_KEY = 'anwesenheitsliste_v4';
    let activeItems = load().active || [];
    let doneItems = load().done || [];

    const listEl = document.getElementById('list');
    const doneListEl = document.getElementById('doneList');
    const totalStat = document.getElementById('totalStat');
    const addForm = document.getElementById('addForm');
    const nameInput = document.getElementById('nameInput');
    const activeTab = document.getElementById('activeTab');
    const doneTab = document.getElementById('doneTab');
    const activeSection = document.getElementById('activeSection');
    const doneSection = document.getElementById('doneSection');
    const backBtn = document.getElementById('backBtn');

    function save(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify({active: activeItems, done: doneItems}));
    }

    function load(){
      try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || {active:[],done:[]}; } catch(e){ return {active:[],done:[]}; }
    }

    function uid(){ return Date.now().toString(36) + Math.random().toString(36).slice(2,7); }

    function render(){
      listEl.innerHTML = '';
      activeItems.forEach(it => {
        if(it.count >= 8) return; // ausgeblendet, wenn fertig

        const li = document.createElement('li');
        const row = document.createElement('div');
        row.className = 'row';

        const name = document.createElement('span');
        name.className = 'name';
        name.textContent = it.name;
        name.addEventListener('click', () => increment(it.id));

        const count = document.createElement('span');
        count.className = 'count';
        count.textContent = `${it.count} / 8`;

        const plusBtn = document.createElement('button');
        plusBtn.className = 'icon-btn';
        plusBtn.textContent = '+';
        plusBtn.addEventListener('click', () => increment(it.id));

        const minusBtn = document.createElement('button');
        minusBtn.className = 'icon-btn';
        minusBtn.textContent = '−';
        minusBtn.addEventListener('click', () => decrement(it.id));

        const checkboxes = document.createElement('div');
        checkboxes.className = 'checkboxes';

        const abgabe = document.createElement('input');
        abgabe.type = 'checkbox';
        abgabe.checked = !!it.registered;
        abgabe.title = 'Abgabe';
        abgabe.addEventListener('change', () => toggleAbgabe(it.id, abgabe.checked));

        const anmeldung = document.createElement('input');
        anmeldung.type = 'checkbox';
        anmeldung.checked = !!it.enrolled;
        anmeldung.title = 'Anmeldung';
        anmeldung.addEventListener('change', () => toggleAnmeldung(it.id, anmeldung.checked));

        checkboxes.append(abgabe, anmeldung);

        row.append(name, minusBtn, plusBtn, count, checkboxes);
        li.append(row);
        listEl.append(li);
      });
      totalStat.textContent = `Gesamt: ${activeItems.length}`;
      save();
    }

    function renderDone(){
      doneListEl.innerHTML = '';
      doneItems.forEach(it => {
        const li = document.createElement('li');
        const row = document.createElement('div');
        row.className = 'row';
        const name = document.createElement('span');
        name.className = 'name';
        name.textContent = it.name;

        const date = document.createElement('span');
        date.className = 'details';
        date.textContent = `Abgeschlossen am ${it.completed}`;

        const detailsBtn = document.createElement('button');
        detailsBtn.className = 'icon-btn';
        detailsBtn.textContent = 'Details';

        const detailsDiv = document.createElement('div');
        detailsDiv.className = 'details hidden';
        detailsDiv.innerHTML = it.dates.map((d,i)=>`${i+1}. ${d}`).join('<br>');
        detailsBtn.addEventListener('click',()=>{
          detailsDiv.classList.toggle('hidden');
        });

        row.append(name, detailsBtn);
        li.append(row, date, detailsDiv);
        doneListEl.append(li);
      });
      save();
    }

    function addItem(name){
      if(!name.trim()) return;
      activeItems.unshift({ id: uid(), name: name.trim(), count: 0, dates: [], registered: false, enrolled: false });
      render();
    }

    function increment(id){
      activeItems = activeItems.map(i => {
        if(i.id === id){
          if(i.count < 8){
            i.count++;
            const datum = new Date().toLocaleDateString('de-DE');
            i.dates.push(datum);
            if(i.count === 8){
              doneItems.unshift({...i, completed: datum});
            }
          }
        }
        return i;
      });
      render();
      renderDone();
    }

    function decrement(id){
      activeItems = activeItems.map(i => {
        if(i.id === id){
          if(i.count > 0){
            i.count--;
            i.dates.pop();
          }
        }
        return i;
      });
      render();
    }

    function toggleAbgabe(id, value){
      activeItems = activeItems.map(i => i.id === id ? {...i, registered:value} : i);
      render();
    }

    function toggleAnmeldung(id, value){
      activeItems = activeItems.map(i => i.id === id ? {...i, enrolled:value} : i);
      render();
    }

    function showActive(){
      activeSection.classList.remove('hidden');
      doneSection.classList.add('hidden');
      activeTab.classList.add('active');
      doneTab.classList.remove('active');
    }

    function showDone(){
      activeSection.classList.add('hidden');
      doneSection.classList.remove('hidden');
      activeTab.classList.remove('active');
      doneTab.classList.add('active');
    }

    addForm.addEventListener('submit', e => {
      e.preventDefault();
      addItem(nameInput.value);
      nameInput.value = '';
      nameInput.focus();
    });

    activeTab.addEventListener('click', showActive);
    doneTab.addEventListener('click', showDone);
    backBtn.addEventListener('click', showActive);

    render();
    renderDone();
  </script>
</body>
</html>
